# ã‚¹ãƒšã‚¯ãƒˆãƒ­ã‚°ãƒ©ãƒ æ™‚é–“è»¸ï¼ˆæ¨ªè»¸ï¼‰ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ä»•æ§˜

## æ¦‚è¦

ã‚¹ãƒšã‚¯ãƒˆãƒ­ã‚°ãƒ©ãƒ è¡¨ç¤ºã«ãŠã‘ã‚‹æ™‚é–“è»¸ï¼ˆæ¨ªè»¸ï¼‰ã®ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«æŒ™å‹•ã‚’å®šç¾©ã™ã‚‹ã€‚
èµ¤ã„å†ç”Ÿã‚«ãƒ¼ã‚½ãƒ«ã¯ç”»é¢ä¸­å¤®ã«å›ºå®šã•ã‚Œã€å†ç”Ÿã®é€²è¡Œã«ä¼´ã„ã€Œç´™ï¼ˆã‚­ãƒ£ãƒ³ãƒã‚¹ï¼‰ãŒå·¦ã¸æµã‚Œã‚‹ã€æ–¹å¼ã‚’æ¡ç”¨ã™ã‚‹ã€‚

---

## ç”¨èªå®šç¾©

| ç”¨èª | èª¬æ˜ |
|------|------|
| `paperLeft` | ãƒ“ãƒ¥ãƒ¼ãƒãƒ¼ãƒˆå·¦ç«¯ã‹ã‚‰è¦‹ãŸã€Œç´™ï¼ˆã‚­ãƒ£ãƒ³ãƒã‚¹ï¼‰ã®å·¦ç«¯ä½ç½®ã€[px]ã€‚ç´™ã‚’å·¦ã¸å‹•ã‹ã™ã»ã©å€¤ã¯å¢—ãˆã‚‹ï¼ˆå³æ–¹å‘ã«é€²ã‚€ï¼‰ã€‚**è² ã®å€¤ã‚’è¨±å®¹**ã€‚ |
| `pps` | pixelsPerSecondï¼ˆå›ºå®šå€¤ã€‚ä¾‹: 50 px/sï¼‰ã€‚æ™‚é–“ã¨ãƒ”ã‚¯ã‚»ãƒ«ã®å¤‰æ›ä¿‚æ•°ã€‚ |
| `vpW` | ã‚¹ãƒšã‚¯ãƒˆãƒ­ã‚°ãƒ©ãƒ é ˜åŸŸã®ãƒ“ãƒ¥ãƒ¼ãƒãƒ¼ãƒˆå¹…[px]ï¼ˆå‘¨æ³¢æ•°ãƒ©ãƒ™ãƒ«åˆ—72pxã‚’é™¤ã„ãŸå¹…ï¼‰ã€‚ |
| `canvasW` | ç´™ï¼ˆå…¨éŒ²éŸ³æ™‚é–“ï¼‰ã®å¹…[px] = `durationSec Ã— pps` |
| `playheadX` | å†ç”Ÿã‚«ãƒ¼ã‚½ãƒ«ã®ãƒ“ãƒ¥ãƒ¼ãƒãƒ¼ãƒˆå†…ã®å›ºå®šXåº§æ¨™[px]ã€‚**å¸¸ã«ç”»é¢ä¸­å¤®** = `vpW / 2` |
| `currentTime` | ç¾åœ¨ã®å†ç”Ÿæ™‚åˆ»[ç§’] |
| `durationSec` | éŒ²éŸ³ã®ç·æ™‚é–“[ç§’] |

---

## ä¸å¤‰æ¡ä»¶

### 1. ã‚¹ã‚±ãƒ¼ãƒ«ã¯å›ºå®š
- `pps`ã¯é€šå¸¸è¡¨ç¤º/ãƒ•ãƒ«ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã§ã‚‚ä¸å¤‰
- 1ç§’ã‚ãŸã‚Šã®ãƒ”ã‚¯ã‚»ãƒ«æ•°ã¯å¸¸ã«50px

### 2. ã‚«ãƒ¼ã‚½ãƒ«ã¯ãƒ“ãƒ¥ãƒ¼ãƒãƒ¼ãƒˆå†…ã§å›ºå®š
- `playheadX = vpW / 2`ï¼ˆç”»é¢ä¸­å¤®ï¼‰
- ç´™ãŒæµã‚Œã€ã‚«ãƒ¼ã‚½ãƒ«ã¯é™æ­¢

### 3. æ™‚é–“ãƒ©ãƒ™ãƒ«ã¯Xæ–¹å‘ã®ã¿è¿½å¾“
- Xè»¸: ç´™ã¨åŒæœŸã—ã¦ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«
- Yè»¸: å›ºå®šï¼ˆ`paperTop`ã®å½±éŸ¿ã‚’å—ã‘ãªã„ï¼‰

### 4. å‘¨æ³¢æ•°ãƒ©ãƒ™ãƒ«ã¯Yæ–¹å‘ã®ã¿è¿½å¾“
- Xè»¸: å›ºå®šï¼ˆãƒ“ãƒ¥ãƒ¼ãƒãƒ¼ãƒˆå·¦ç«¯ã€å¹…72pxï¼‰
- Yè»¸: ç´™ã¨åŒæœŸã—ã¦ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ï¼ˆ`-paperTop`ï¼‰

---

## paperLeftã®æ›´æ–°å¼

### åŸºæœ¬å¼
```swift
paperLeft(t) = min(currentTime * pps - playheadX, canvasW - playheadX)
```

### èª¬æ˜
- **é€šå¸¸æ™‚**: `paperLeft(t) = currentTime * pps - playheadX`
  - å†ç”ŸãŒé€²ã‚€ã¨ç´™ãŒå·¦ã¸æµã‚Œã‚‹
  - èµ¤ç·šï¼ˆ`playheadX`ï¼‰ã®çœŸä¸‹ã«`currentTime`ä½ç½®ãŒæ¥ã‚‹

- **ä¸Šé™**: `canvasW - playheadX`
  - ç´™ã®å³ç«¯ï¼ˆéŒ²éŸ³çµ‚ç«¯ï¼‰ãŒèµ¤ç·šã«åˆ°é”ã—ãŸã‚‰åœæ­¢
  - ãã‚Œä»¥ä¸Šç´™ã¯æµã‚Œãªã„

- **ä¸‹é™**: ãªã—
  - è² ã®å€¤ã‚’è¨±å®¹ã™ã‚‹
  - åˆæœŸçŠ¶æ…‹ã§`paperLeft(0) = -playheadX`

---

## åˆæœŸçŠ¶æ…‹ (currentTime = 0)

### paperLeftã®åˆæœŸå€¤
```swift
paperLeft(0) = min(0 * pps - playheadX, canvasW - playheadX)
            = min(-playheadX, canvasW - playheadX)
            = -playheadX  // é€šå¸¸ã¯å·¦å´ã®å€¤
```

### è¦–è¦šçš„çŠ¶æ…‹
- ç´™ã®å·¦ç«¯ï¼ˆ0sä½ç½®ï¼‰ãŒèµ¤ç·šï¼ˆç”»é¢ä¸­å¤®ï¼‰ã«æ¥ã™ã‚‹
- èµ¤ç·šã®çœŸä¸‹ã«0sãƒ©ãƒ™ãƒ«ãŒè¡¨ç¤ºã•ã‚Œã‚‹
- èµ¤ç·šã‚ˆã‚Šå·¦å´ã«`playheadX`åˆ†ã®**ã‚°ãƒ¬ãƒ¼ä½™ç™½**ãŒè¦‹ãˆã‚‹
- ã“ã‚Œã¯**ä»•æ§˜é€šã‚Šã®æ­£ã—ã„è¡¨ç¤º**

### åˆæœŸè¡¨ç¤ºã‚¤ãƒ¡ãƒ¼ã‚¸
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ãƒ“ãƒ¥ãƒ¼ãƒãƒ¼ãƒˆ (vpW = 600px)                            â”‚
â”‚                                                      â”‚
â”‚ [ã‚°ãƒ¬ãƒ¼ä½™ç™½ 300px]     0s   1s   2s   3s   4s   5s  â”‚
â”‚                        â†‘                             â”‚
â”‚                     ç´™ã®å·¦ç«¯                          â”‚
â”‚                                                      â”‚
â”‚         ç”»é¢ä¸­å¤® (playheadX = 300px)                  â”‚
â”‚            â†“                                         â”‚
â”‚            â”ƒ â† èµ¤ç·šï¼ˆå›ºå®šï¼‰                           â”‚
â”‚            â”ƒ                                         â”‚
â”‚         0sãŒèµ¤ç·šçœŸä¸‹                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## å†ç”Ÿä¸­ã®æŒ™å‹•

### t = 3ç§’ã®ä¾‹

**å‰æ**:
- `vpW = 600px`
- `playheadX = 300px`
- `pps = 50px/s`
- `durationSec = 10s`
- `canvasW = 500px`
- `currentTime = 3.0s`

**è¨ˆç®—**:
```swift
paperLeft(3) = min(3 * 50 - 300, 500 - 300)
            = min(150 - 300, 200)
            = min(-150, 200)
            = -150px
```

**è¦–è¦šçš„çŠ¶æ…‹**:
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ãƒ“ãƒ¥ãƒ¼ãƒãƒ¼ãƒˆ (vpW = 600px)                            â”‚
â”‚                                                      â”‚
â”‚ [ä½™ç™½150px]  0s   1s   2s   3s   4s   5s   6s   7s  â”‚
â”‚              â†‘              â†‘                        â”‚
â”‚           ç´™ã®å·¦ç«¯       ç”»é¢ä¸­å¤®                      â”‚
â”‚                          â†“                           â”‚
â”‚                          â”ƒ â† èµ¤ç·š                    â”‚
â”‚                          â”ƒ                           â”‚
â”‚                       3sãŒèµ¤ç·šçœŸä¸‹ âœ…                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**æ™‚é–“ãƒ©ãƒ™ãƒ«ã®ç”»é¢å†…ä½ç½®**:
```swift
// Canvasæç”»åº§æ¨™ï¼ˆpaperLeftã‚ªãƒ•ã‚»ãƒƒãƒˆé©ç”¨å‰ï¼‰
0s: x = 0 * 50 = 0px
3s: x = 3 * 50 = 150px

// .offset(x: -paperLeft) = .offset(x: 150) é©ç”¨å¾Œ
0s: 0 + 150 = 150px
3s: 150 + 150 = 300px = playheadX âœ…
```

---

## éŒ²éŸ³çµ‚ç«¯ã§ã®æŒ™å‹•

### ä¸Šé™åˆ°é”ã®è¨ˆç®—

**å‰æ** (åŒä¸Š):
- `canvasW = 500px`
- `playheadX = 300px`
- `durationSec = 10s`

**ä¸Šé™**:
```swift
paperLeft_max = canvasW - playheadX = 500 - 300 = 200px
```

**ä¸Šé™åˆ°é”æ™‚åˆ»**:
```swift
currentTime * pps - playheadX = 200
currentTime * 50 - 300 = 200
currentTime * 50 = 500
currentTime = 10ç§’  // éŒ²éŸ³çµ‚ç«¯ âœ…
```

### t = 10ç§’ã®çŠ¶æ…‹
```swift
paperLeft(10) = min(10 * 50 - 300, 500 - 300)
             = min(500 - 300, 200)
             = min(200, 200)
             = 200px
```

**è¦–è¦šçš„çŠ¶æ…‹**:
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ãƒ“ãƒ¥ãƒ¼ãƒãƒ¼ãƒˆ (vpW = 600px)                            â”‚
â”‚                                                      â”‚
â”‚ 4s   5s   6s   7s   8s   9s  10s [ä½™ç™½300px]        â”‚
â”‚                         â†‘    â†‘                      â”‚
â”‚                    ç”»é¢ä¸­å¤®  ç´™ã®å³ç«¯                 â”‚
â”‚                      â†“                               â”‚
â”‚                      â”ƒ â† èµ¤ç·š                        â”‚
â”‚                      â”ƒ                               â”‚
â”‚                   10sãŒèµ¤ç·šçœŸä¸‹ âœ…                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**éŒ²éŸ³çµ‚ç«¯ã®ç”»é¢å†…ä½ç½®**:
```swift
// ç´™ä¸Šã®çµ‚ç«¯ä½ç½®
endPos = 10 * 50 = 500px

// ãƒ“ãƒ¥ãƒ¼ãƒãƒ¼ãƒˆå†…ã§ã®è¡¨ç¤ºä½ç½®
viewportX = endPos - paperLeft
         = 500 - 200
         = 300px
         = playheadX âœ…
```

---

## ãƒ•ãƒ«ã‚¹ã‚¯ãƒªãƒ¼ãƒ³åˆ‡æ›¿æ™‚ã®æŒ™å‹•

### å¤‰æ›´ã•ã‚Œã‚‹å€¤
- `vpW`: ãƒ“ãƒ¥ãƒ¼ãƒãƒ¼ãƒˆå¹…ãŒæ‹¡å¤§
- `playheadX = vpW / 2`: ç”»é¢ä¸­å¤®ä½ç½®ãŒå¤‰åŒ–

### å¤‰æ›´ã•ã‚Œãªã„å€¤
- `pps`: 50px/s ã§å›ºå®šï¼ˆã‚»ãƒ«ã®å¹…ã¯ä¸å¤‰ï¼‰
- `canvasW`: éŒ²éŸ³æ™‚é–“ã¯å¤‰ã‚ã‚‰ãªã„
- `currentTime`: å†ç”Ÿä½ç½®ã¯ç¶™ç¶š

### åˆ‡æ›¿å¾Œã®å‡¦ç†
```swift
// æ–°ã—ã„playheadXã‚’è¨ˆç®—
let newPlayheadX = newVpW / 2

// paperLeftã‚’å†è¨ˆç®—
let paperLeft_target = currentTime * pps - newPlayheadX
let paperLeft_max = canvasW - newPlayheadX
paperLeft = min(paperLeft_target, paperLeft_max)
```

---

## æ¥µç«¯ã‚±ãƒ¼ã‚¹: canvasW < playheadX

### çŠ¶æ³
éå¸¸ã«çŸ­ã„éŒ²éŸ³ï¼ˆä¾‹: 3ç§’ï¼‰ã§ãƒ“ãƒ¥ãƒ¼ãƒãƒ¼ãƒˆãŒåºƒã„å ´åˆ:
- `durationSec = 3s`
- `canvasW = 3 * 50 = 150px`
- `vpW = 600px`
- `playheadX = 300px`

### æŒ™å‹•
```swift
paperLeft_max = canvasW - playheadX = 150 - 300 = -150px
```

**t = 0**:
```swift
paperLeft(0) = min(0 - 300, -150) = min(-300, -150) = -300
```

**t = 3ç§’**:
```swift
paperLeft(3) = min(3*50 - 300, -150)
            = min(150 - 300, -150)
            = min(-150, -150)
            = -150px  // ä¸Šé™åˆ°é”
```

**çµæœ**:
- åˆæœŸçŠ¶æ…‹: ç´™ã®å·¦ç«¯ãŒèµ¤ç·šã‚ˆã‚Šå·¦ï¼ˆ`-300px`ï¼‰
- å†ç”Ÿçµ‚ç«¯: ç´™ã®å³ç«¯ãŒèµ¤ç·šã«åˆ°é”ï¼ˆ`-150px`ï¼‰
- æç”»ã‚¯ãƒªãƒƒãƒ—ã«ã‚ˆã‚Šã€ç¯„å›²å¤–ã¯æç”»ã•ã‚Œãªã„
- **ä»•æ§˜é€šã‚Šã®æ­£ã—ã„æŒ™å‹•**

---

## æ™‚é–“ãƒ©ãƒ™ãƒ«ã®æç”»

### Canvasæç”»ã‚³ãƒ¼ãƒ‰
```swift
Canvas { context, size in
    let labelInterval: Double = 1.0  // 1ç§’é–“éš”
    var time: Double = 0

    // 0ç§’ ã€œ durationSecã¾ã§ã®ãƒ©ãƒ™ãƒ«ã‚’ç”Ÿæˆ
    while time <= durationSec {
        let x = CGFloat(time) * pixelsPerSecond
        let y = size.height / 2  // Yæ–¹å‘ã¯å›ºå®šï¼ˆä¸­å¤®ï¼‰

        let text = Text(String(format: "%.0fs", time))
            .font(.caption)
            .foregroundColor(.gray)

        // å·¦ç«¯ã‹ã‚‰ã®æç”»ï¼ˆcutoffé˜²æ­¢ï¼‰
        context.draw(text, at: CGPoint(x: x, y: y), anchor: .leading)

        time += labelInterval
    }
}
.frame(width: spectroViewportW, height: timeLabelHeight)
.offset(x: -paperLeft)  // Xæ–¹å‘ã®ã¿ç´™ã¨åŒæœŸ
.clipped()
```

### ãƒã‚¤ãƒ³ãƒˆ
- **Xåº§æ¨™**: Canvaså†…ã§`time * pps`ã§è¨ˆç®—ã€`.offset(x: -paperLeft)`ã§åŒæœŸ
- **Yåº§æ¨™**: `size.height / 2`ã§å›ºå®šï¼ˆ`paperTop`ã®å½±éŸ¿ãªã—ï¼‰
- **æç”»ç¯„å›²**: `0 <= time <= durationSec`ã®ã¿
- **anchor**: `.leading`ã§å·¦ç«¯åŸºæº–ï¼ˆcutoffé˜²æ­¢ï¼‰

---

## èµ¤ç·šï¼ˆå†ç”Ÿã‚«ãƒ¼ã‚½ãƒ«ï¼‰ã®æç”»

### Canvasæç”»ã‚³ãƒ¼ãƒ‰
```swift
Canvas { context, size in
    // playheadXã®å›ºå®šä½ç½®ã«å‚ç›´ç·šã‚’æç”»
    let playheadX = size.width / 2  // ç”»é¢ä¸­å¤®

    context.stroke(
        Path { path in
            path.move(to: CGPoint(x: playheadX, y: 0))
            path.addLine(to: CGPoint(x: playheadX, y: size.height))
        },
        with: .color(.red),
        lineWidth: 2
    )
}
.frame(width: spectroViewportW, height: viewportHeight)
.allowsHitTesting(false)
```

### ãƒã‚¤ãƒ³ãƒˆ
- **ä½ç½®**: `playheadX = size.width / 2`ï¼ˆç”»é¢ä¸­å¤®å›ºå®šï¼‰
- **ã‚ªãƒ•ã‚»ãƒƒãƒˆãªã—**: `.offset()`ã‚’é©ç”¨ã—ãªã„
- **z-index**: ã‚¹ãƒšã‚¯ãƒˆãƒ­ã‚°ãƒ©ãƒ ã®ä¸Šã«é‡ã­ã‚‹

---

## å—ã‘å…¥ã‚ŒåŸºæº–ï¼ˆç›®è¦–ç¢ºèªé …ç›®ï¼‰

### âœ… ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ

1. **åˆæœŸè¡¨ç¤º**:
   - [ ] 0sãƒ©ãƒ™ãƒ«ãŒç”»é¢ä¸­å¤®ã®èµ¤ç·šçœŸä¸‹ã«è¡¨ç¤º
   - [ ] èµ¤ç·šã‚ˆã‚Šå·¦å´ã«ã‚°ãƒ¬ãƒ¼ä½™ç™½ãŒå­˜åœ¨
   - [ ] èµ¤ç·šã‚ˆã‚Šå³å´ã«ã‚¹ãƒšã‚¯ãƒˆãƒ­ã‚°ãƒ©ãƒ ãŒè¡¨ç¤º

2. **å†ç”Ÿä¸­**:
   - [ ] èµ¤ç·šã¯ç”»é¢ä¸­å¤®ã§é™æ­¢
   - [ ] ã‚¹ãƒšã‚¯ãƒˆãƒ­ã‚°ãƒ©ãƒ ãŒå·¦ã¸æµã‚Œã‚‹
   - [ ] æ™‚é–“ãƒ©ãƒ™ãƒ«ãŒã‚¹ãƒšã‚¯ãƒˆãƒ­ã‚°ãƒ©ãƒ ã¨åŒæœŸã—ã¦æµã‚Œã‚‹
   - [ ] èµ¤ç·šã®çœŸä¸‹ã«å¸¸ã«`currentTime`ã®ãƒ©ãƒ™ãƒ«ãŒä½ç½®

3. **ç¸¦ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«**:
   - [ ] å‘¨æ³¢æ•°ã‚’ä¸Šä¸‹ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ã—ã¦ã‚‚æ™‚é–“ãƒ©ãƒ™ãƒ«å¸¯ã¯å‹•ã‹ãªã„
   - [ ] æ™‚é–“ãƒ©ãƒ™ãƒ«ã®Yä½ç½®ã¯å®Œå…¨å›ºå®š

4. **ãƒ•ãƒ«ã‚¹ã‚¯ãƒªãƒ¼ãƒ³åˆ‡æ›¿**:
   - [ ] ã‚»ãƒ«ï¼ˆãƒã‚¹ç›®ï¼‰ã®å¹…ã¯ä¸å¤‰ï¼ˆppså›ºå®šï¼‰
   - [ ] è¦‹ãˆã‚‹ç¯„å›²ã®ã¿æ‹¡å¤§
   - [ ] å†ç”Ÿä½ç½®ã¯ç¶™ç¶š

5. **éŒ²éŸ³çµ‚ç«¯**:
   - [ ] ç´™ã®å³ç«¯ãŒèµ¤ç·šã«åˆ°é”ã—ãŸã‚‰åœæ­¢
   - [ ] éŒ²éŸ³çµ‚ç«¯ï¼ˆdurationSecï¼‰ã®ãƒ©ãƒ™ãƒ«ãŒèµ¤ç·šçœŸä¸‹ã«è¡¨ç¤º
   - [ ] ãã‚Œä»¥ä¸Šç´™ã¯æµã‚Œãªã„

6. **å‘¨æ³¢æ•°ãƒ©ãƒ™ãƒ«ã¨ã®ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆ**:
   - [ ] å‘¨æ³¢æ•°ãƒ©ãƒ™ãƒ«åˆ—ï¼ˆå·¦72pxï¼‰ã¨é‡ãªã‚‰ãªã„
   - [ ] å„è¦ç´ ãŒæ˜ç¢ºã«åˆ†é›¢ã•ã‚Œã¦ã„ã‚‹

---

## å—ã‘å…¥ã‚ŒåŸºæº–ã®ãƒ­ã‚°æ¤œè¨¼å¼

**é‡è¦**: ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚·ãƒ§ãƒƒãƒˆã«ã‚ˆã‚‹ç›®è¦–ç¢ºèªã¯ä¸æ­£ç¢ºãªãŸã‚ã€ä»¥ä¸‹ã®æ•°å¼ã‚’ãƒ­ã‚°å‡ºåŠ›ã§å®šé‡çš„ã«æ¤œè¨¼ã™ã‚‹ã€‚

### æ¤œè¨¼é …ç›®ã¨æœŸå¾…å€¤

#### 1. åˆæœŸè¡¨ç¤ºï¼ˆcurrentTime = 0ï¼‰

**æ¤œè¨¼1-1**: 0sãƒ©ãƒ™ãƒ«ãŒèµ¤ç·šçœŸä¸‹ã«è¡¨ç¤º
```
paperLeft = -playheadX  (Expected)
0sãƒ©ãƒ™ãƒ«ã®xåº§æ¨™ = 0 * pps - paperLeft = playheadX  (Expected)
è¨±å®¹èª¤å·®: Â±1.0 px
```

**æ¤œè¨¼1-2**: èµ¤ç·šã‚ˆã‚Šå·¦å´ã«ã‚°ãƒ¬ãƒ¼ä½™ç™½ãŒå­˜åœ¨
```
paperLeft < 0  (Expected: è² ã®å€¤)
```

**æ¤œè¨¼1-3**: èµ¤ç·šã‚ˆã‚Šå³å´ã«ã‚¹ãƒšã‚¯ãƒˆãƒ­ã‚°ãƒ©ãƒ ãŒè¡¨ç¤º
```
canvasWidth > playheadX  (Expected)
```

#### 2. å†ç”Ÿä¸­ï¼ˆä¾‹: currentTime = 1.0sï¼‰

**æ¤œè¨¼2-1**: èµ¤ç·šã®çœŸä¸‹ã« currentTime ã®ãƒ©ãƒ™ãƒ«ãŒä½ç½®
```
paperLeft = currentTime * pps - playheadX  (Expected)
currentTimeãƒ©ãƒ™ãƒ«ã®xåº§æ¨™ = currentTime * pps - paperLeft = playheadX  (Expected)
è¨±å®¹èª¤å·®: Â±1.0 px
```

#### 3. éŒ²éŸ³çµ‚ç«¯ï¼ˆcurrentTime = durationSecï¼‰

**æ¤œè¨¼3-1**: éŒ²éŸ³çµ‚ç«¯ã®ãƒ©ãƒ™ãƒ«ãŒèµ¤ç·šçœŸä¸‹ã«è¡¨ç¤º
```
paperLeft = min(durationSec * pps - playheadX, canvasW - playheadX)  (Expected)
durationSecãƒ©ãƒ™ãƒ«ã®xåº§æ¨™ = durationSec * pps - paperLeft = playheadX  (Expected)
è¨±å®¹èª¤å·®: Â±1.0 px
```

### ãƒ­ã‚°å‡ºåŠ›å†…å®¹

ä»¥ä¸‹ã®å€¤ã‚’æ¯ãƒ•ãƒ¬ãƒ¼ãƒ ï¼ˆã¾ãŸã¯é‡è¦ãªã‚¿ã‚¤ãƒŸãƒ³ã‚°ã§ï¼‰ãƒ­ã‚°å‡ºåŠ›ã™ã‚‹ï¼š

```
ğŸ“ TIME AXIS VERIFICATION:
- paperLeft (offsetX): <å®Ÿéš›ã®å€¤>
- playheadX: <å®Ÿéš›ã®å€¤>
- Expected paperLeft: <currentTime * pps - playheadX>
- 0s label x-coord: <0 * pps - paperLeft>
- Should 0s be at playheadX? <|0sãƒ©ãƒ™ãƒ«x - playheadX| < 1.0>
- currentTime: <å®Ÿéš›ã®å€¤>
- currentTime label x-coord: <currentTime * pps - paperLeft>
- Should currentTime be at playheadX? <|currentTimeãƒ©ãƒ™ãƒ«x - playheadX| < 1.0>
- canvasWidth: <å®Ÿéš›ã®å€¤>, spectroViewportW: <å®Ÿéš›ã®å€¤>
```

### åˆæ ¼åˆ¤å®š

ä»¥ä¸‹ã®æ¡ä»¶ã‚’**ã™ã¹ã¦**æº€ãŸã™å¿…è¦ãŒã‚ã‚‹ï¼š

1. **åˆæœŸçŠ¶æ…‹**: `|0sãƒ©ãƒ™ãƒ«x - playheadX| < 1.0` ãŒ `true`
2. **åˆæœŸçŠ¶æ…‹**: `paperLeft < 0` ãŒ `true`
3. **å†ç”Ÿä¸­**: `|currentTimeãƒ©ãƒ™ãƒ«x - playheadX| < 1.0` ãŒ `true`ï¼ˆä»»æ„ã® currentTime ã§ï¼‰
4. **éŒ²éŸ³çµ‚ç«¯**: `|durationSecãƒ©ãƒ™ãƒ«x - playheadX| < 1.0` ãŒ `true`

---

## å®Ÿè£…ãƒã‚§ãƒƒã‚¯ãƒã‚¤ãƒ³ãƒˆ

### 1. paperLeftã®åˆæœŸåŒ–
```swift
// âš ï¸ é‡è¦: è² ã®å€¤ã‚’è¨±å®¹
paperLeft = currentTime * pixelsPerSecond - playheadX
// åˆæœŸçŠ¶æ…‹ã§ paperLeft = -playheadX ã«ãªã‚‹
```

### 2. paperLeftã®æ›´æ–°ï¼ˆå†ç”Ÿä¸­ï¼‰
```swift
// currentTimeå¤‰åŒ–æ™‚ã«å‘¼ã³å‡ºã™
func updatePaperLeft() {
    let playheadX = spectroViewportW / 2
    let paperLeft_target = currentTime * pixelsPerSecond - playheadX
    let paperLeft_max = canvasWidth - playheadX
    paperLeft = min(paperLeft_target, paperLeft_max)
}
```

### 3. åˆæœŸåŒ–ãƒ•ãƒ©ã‚°ã®å‰Šé™¤
```swift
// âŒ å‰Šé™¤: isPaperLeftInitializedãƒ•ãƒ©ã‚°ã¯ä¸è¦
// paperLeftã¯æ¯ãƒ•ãƒ¬ãƒ¼ãƒ æ›´æ–°å¼ã§è¨ˆç®—ã•ã‚Œã‚‹
```

### 4. æç”»ç¯„å›²ã®åˆ¶é™
```swift
// æ™‚é–“ãƒ©ãƒ™ãƒ«
while time <= durationSec {  // durationè¶…ã¯æç”»ã—ãªã„
    // ...
}

// ã‚¹ãƒšã‚¯ãƒˆãƒ­ã‚°ãƒ©ãƒ 
// åŒæ§˜ã«durationSecã¾ã§ã®ãƒ‡ãƒ¼ã‚¿ã®ã¿æç”»
```

---

## ã¾ã¨ã‚

### è¨­è¨ˆã®æ ¸å¿ƒ
1. **èµ¤ç·šå›ºå®š**: `playheadX = vpW / 2`ã§ç”»é¢ä¸­å¤®ã«å›ºå®š
2. **ç´™ãŒæµã‚Œã‚‹**: `paperLeft = currentTime * pps - playheadX`ã§ç´™ã‚’å·¦ã¸ç§»å‹•
3. **è² ã®å€¤è¨±å®¹**: åˆæœŸçŠ¶æ…‹ã§`paperLeft = -playheadX`ï¼ˆå·¦å´ã«ä½™ç™½ï¼‰
4. **ä¸Šé™åˆ¶å¾¡**: `paperLeft <= canvasW - playheadX`ï¼ˆå³ç«¯ã§åœæ­¢ï¼‰

### æ™‚é–“ãƒ©ãƒ™ãƒ«ã®åŒæœŸ
- Xæ–¹å‘: `.offset(x: -paperLeft)`ã§ç´™ã¨å®Œå…¨åŒæœŸ
- Yæ–¹å‘: å›ºå®šï¼ˆ`paperTop`ã®å½±éŸ¿ãªã—ï¼‰

### å‘¨æ³¢æ•°ãƒ©ãƒ™ãƒ«ã®åˆ†é›¢
- Xæ–¹å‘: å›ºå®šï¼ˆå·¦åˆ—72pxï¼‰
- Yæ–¹å‘: `.offset(y: -paperTop)`ã§ç´™ã¨åŒæœŸ

### 3ãƒ¬ãƒ¼ãƒ³æ§‹æˆ
```
HStack(spacing: 0) {
    FrequencyLabelsView()     // å·¦åˆ—: Xå›ºå®š, Yè¿½å¾“
    VStack(spacing: 0) {
        SpectrogramCanvas()   // å³ä¸Š: XYè¿½å¾“
        TimeLabelsCanvas()    // å³ä¸‹: Xè¿½å¾“, Yå›ºå®š
    }
}
```
